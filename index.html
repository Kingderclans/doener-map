```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Döner Map</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Firebase SDK -->
    <script type="module">
      // Firebase Import
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
        doc,
        updateDoc,
      } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";

      // Firebase Config
      const firebaseConfig = {
        apiKey: "AIzaSyCBWlHG4LLLPM-_dWV2eqw0Vwh1BvlcL-A",
        authDomain: "activespiess-433b5.firebaseapp.com",
        projectId: "activespiess-433b5",
        storageBucket: "activespiess-433b5.appspot.com",
        messagingSenderId: "927921088097",
        appId: "1:927921088097:web:05e6691473e3ded984ac20",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      let currentUid = null;

      // === Map erstellen ===
      const map = L.map("map").setView([52.52, 13.405], 12);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
      }).addTo(map);

      // === Dönerläden laden ===
      async function loadDoener() {
        const querySnapshot = await getDocs(collection(db, "doenerlaeden"));
        querySnapshot.forEach((docSnap) => {
          const data = docSnap.data();

          // Koordinaten in Numbers konvertieren
          let coords = data.coords;
          if (Array.isArray(coords) && coords.length === 2) {
            coords = [Number(coords[0]), Number(coords[1])];
          } else {
            coords = [52.52, 13.405]; // fallback Berlin
          }

          if (coords.some(isNaN)) {
            coords = [52.52, 13.405];
          }

          // Popup HTML
          let popupContent = `
            <b>${data.name || "Unbenannt"}</b><br>
            Spieß: ${data.spiess || "?"}<br>
            Öffnungszeiten: ${data.oeffnungszeiten || "-"}<br>
            Adresse: ${data.addr || "-"}<br>
            Tel: ${data.tel || "-"}<br>
          `;

          // Wenn Anbieter eingeloggt UND ownerUid matcht → Edit-Form
          if (currentUid && data.ownerUid === currentUid) {
            popupContent += `
              <hr>
              <label>Spieß: <input id="spiess-${docSnap.id}" value="${data.spiess || ""}"></label><br>
              <label>Öffnungszeiten: <input id="oeff-${docSnap.id}" value="${data.oeffnungszeiten || ""}"></label><br>
              <button onclick="saveDoener('${docSnap.id}')">Speichern</button>
            `;
          }

          L.marker(coords).addTo(map).bindPopup(popupContent);
        });
      }

      // === Speichern-Funktion für Anbieter ===
      window.saveDoener = async function (id) {
        const spiessVal = document.getElementById("spiess-" + id).value;
        const oeffVal = document.getElementById("oeff-" + id).value;
        await updateDoc(doc(db, "doenerlaeden", id), {
          spiess: spiessVal,
          oeffnungszeiten: oeffVal,
        });
        alert("Daten gespeichert!");
      };

      // === Auth beobachten ===
      onAuthStateChanged(auth, (user) => {
        if (user) {
          currentUid = user.uid;
        } else {
          currentUid = null;
        }
        // Karte neu laden (damit Edit-Felder sichtbar werden)
        loadDoener();
      });

      // === Test-Login (Demo Anbieter) ===
      // Hier deine Anbieter-Login Daten nutzen
      signInWithEmailAndPassword(auth, "anbieter@test.de", "test123").catch(
        (err) => console.error(err)
      );
    </script>
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
```
