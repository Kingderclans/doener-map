doenerLaeden.forEach((laden, index) => {
  // 1️⃣ Farbe bestimmen
  const getColor = status => status === "Spieß da" ? "green" :
                             status === "Spieß aus" ? "red" : "gray";

  // 2️⃣ Marker erstellen und auf die Karte setzen
  const marker = L.circleMarker([laden.lat, laden.lng], { 
      color: getColor(laden.status), // Marker-Farbe
      radius: 8 // Größe
  }).addTo(map);

  // 3️⃣ Popup mit Infos + Dropdown + Button
  marker.bindPopup(`
    <b>${laden.name}</b><br>
    Status: <span id="status-${index}">${laden.status}</span><br>
    <select id="select-${index}">
      <option value="Spieß da">Spieß da</option>
      <option value="Spieß aus">Spieß aus</option>
      <option value="geschlossen">geschlossen</option>
    </select>
    <button id="btn-${index}">Ändern</button>
  `);

  // 4️⃣ EventListener, damit Button im Popup funktioniert
  marker.on("popupopen", () => {
    const btn = document.getElementById(`btn-${index}`);
    const select = document.getElementById(`select-${index}`);
    btn.addEventListener("click", () => {
      const status = select.value;
      doenerLaeden[index].status = status;

      // Marker-Farbe aktualisieren
      marker.setStyle({ color: getColor(status) });

      // Popup-Status aktualisieren
      document.getElementById(`status-${index}`).innerText = status;
    });
  });
});
